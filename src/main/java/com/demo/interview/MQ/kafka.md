# kafka

    https://www.open-open.com/project/5041490600333883253.html
    
##概念    
1.  Kafka是一个高吞吐量分布式消息系统。linkedin开源的kafka。 Kafka就跟这个名字一样，设计非常独特。
    首先，kafka的开发者们认为不需要在内存里缓存什么数据，
    操作系统的文件缓存已经足够完善和强大，只要你不搞随机写，顺序读写的性能是非常高效的。
    kafka的数据只会顺序append，数据的删除策略是累积到一定程度或者超过一定时间再删除。
2.  Kafka另一个独特的地方是将消费者信息保存在客户端而不是MQ服务器，这样服务器就不用记录消息的投递过程，
    每个客户端都自己知道自己下一次应该从什么地方什么位置读取消息，
    消息的投递过程也是采用客户端主动pull的模型，这样大大减轻了服务器的负担。
    Kafka还强调减少数据的序列化和拷贝开销，它会将一些消息组织成Message Set做批量存储和发送，
    并且客户端在pull数据的时候，尽量以zero-copy的方式传输，利用sendfile
    （对应java里的 FileChannel.transferTo/transferFrom）这样的高级IO函数来减少拷贝开销。
    可见，kafka是一个精心设计，特定于某些应用的MQ系统，这种偏向特定领域的MQ系统我估计会越来越多，
    垂直化的产品策略值的考虑。

##特性
Kafka特性:
    通过O(1)的磁盘数据结构提供消息的持久化，这种结构对于即使数以TB消息存储也能保持长时间的稳定性能。
    高吞吐量：即使是非常普通的硬件Kafka也可以支持每秒数百万的消息。
    Partition、Consumer Group
    
##优点：
    可扩展。Kafka集群可以透明的扩展，增加新的服务器进集群。
    高性能。Kafka性能远超过传统的ActiveMQ、RabbitMQ等，Kafka支持Batch操作。
    容错性。Kafka每个Partition数据会复制到几台服务器，当某个Broker失效时，
        Zookeeper将通知生产者和消费者从而使用其他的Broker    
    
#### 高性能
    1.Broker NIO 异步消息处理，实现了 IO 线程与业务线程分离
    2.磁盘顺序写
    3.零拷贝  [https://blog.csdn.net/u013018618/article/details/80146617]
    
    
  >传统
  >①一个read系统调用后，DMA执行了一次数据拷贝，从磁盘到内核空间
  
  >②read结束后，发生第二次数据拷贝，由cpu将数据从内核空间拷贝至用户空间
  
  >③send系统调用，cpu发生第三次数据拷贝，由cpu将数据从用户空间拷贝至内核空间(socket缓冲区)
  
  >④send系统调用结束后，DMA执行第四次数据拷贝，将数据从内核拷贝至协议引擎
  
  >⑤另外，这四个过程中，每个过程都发生一次上下文切换
  
  
  >零拷贝
  1.io读写的方式
  1.1中断
  1.2DMA
  2.中断方式
  2.1中断方式的流程图如下：
      ①用户进程发起数据读取请求
      ②系统调度为该进程分配cpu
      ③cpu向io控制器(ide,scsi)发送io请求
      ④用户进程等待io完成，让出cpu
      ⑤系统调度cpu执行其他任务
      ⑥数据写入至io控制器的缓冲寄存器
      ⑦缓冲寄存器满了向cpu发出中断信号
      ⑧cpu读取数据至内存
  2.2缺点：中断次数取决于缓冲寄存器的大小
  3.DMA ： 直接内存存取
    3.1DMA方式的流程图如下：
      ①用户进程发起数据读取请求
      ②系统调度为该进程分配cpu
      ③cpu向DMA发送io请求
      ④用户进程等待io完成，让出cpu
      ⑤系统调度cpu执行其他任务
      ⑥数据写入至io控制器的缓冲寄存器
      ⑦DMA不断获取缓冲寄存器中的数据（需要cpu时钟）
      ⑧传输至内存（需要cpu时钟）
      ⑨所需的全部数据获取完毕后向cpu发出中断信号
    3.2优点：减少cpu中断次数，不用cpu拷贝数据
    
##缺点：
    重复消息。Kafka保证每条消息至少送达一次，虽然几率很小，但一条消息可能被送达多次。
    消息乱序。Kafka某一个固定的Partition内部的消息是保证有序的，如果一个Topic有多个Partition，
        partition之间的消息送达不保证有序。
    复杂性。Kafka需要Zookeeper的支持，Topic一般需要人工创建，部署和维护比一般MQ成本更高。    
    
    
    
    
    
    